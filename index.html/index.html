<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Form</title>
  <style>
    body {
      background: black;
      color: #aaa;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }

    .outer-box {
      background: #0a0f30;
      border-radius: 0;
      padding: 20px;
      display: inline-block;
      margin: 15px auto;
    }

    .outer-box input {
      background: #1a2340;
      color: #aaa;
      border: 2px solid #0a0f30;
      padding: 20px;
      font-size: 18px;
      width: 300px;
      outline: none;
      box-sizing: border-box;
    }

    button {
      background: #555;
      color: #aaa;
      border: 2px solid #888;
      border-radius: 5px;
      padding: 15px 60px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
    }

    #message {
      margin-top: 20px;
      color: #aaa;
      font-size: 18px;
    }
  </style>
</head>
<body>

<p>How long did it take him to smile?</p>

<div class="outer-box">
  <input type="text" id="box1" placeholder="Box 1">
</div>

<br>

<div class="outer-box">
  <input type="text" id="box2" placeholder="Box 2">
</div>

<br>

<button id="submitBtn"></button>
<p id="message"></p>

<!-- Firebase SDK -->
<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyA6CxVBm-kw7FcYho3-ajLe0JpSlOaWI98",
    authDomain: "how-long-did-it-take-to-smile.firebaseapp.com",
    projectId: "how-long-did-it-take-to-smile",
    storageBucket: "how-long-did-it-take-to-smile.appspot.com",
    messagingSenderId: "206169272440",
    appId: "1:206169272440:web:03208a7c05b26ee8147d8d",
    measurementId: "G-VE0LZRLPM4"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const box1 = document.getElementById("box1");
  const box2 = document.getElementById("box2");
  const submitBtn = document.getElementById("submitBtn");
  const message = document.getElementById("message");

  let clickCounter = 0;
  let lastPermutation = "";

  // Save inputs on blur
  box1.addEventListener("blur", async () => {
    const input1 = box1.value;
    if(input1) {
      try {
        await addDoc(collection(db, "inputs"), { box: "box1", value: input1, timestamp: Date.now() });
        console.log("Box1 input saved!");
      } catch(e) { console.error("Error saving Box1:", e); }
    }
  });

  box2.addEventListener("blur", async () => {
    const input2 = box2.value;
    if(input2) {
      try {
        await addDoc(collection(db, "inputs"), { box: "box2", value: input2, timestamp: Date.now() });
        console.log("Box2 input saved!");
      } catch(e) { console.error("Error saving Box2:", e); }
    }
  });

  // Submit button logic
  submitBtn.addEventListener("click", () => {
    const val1 = box1.value.trim();
    const val2 = box2.value.trim();
    let perm = "";

    // Define validation
    const valid1 = val1 === "@depedmarikina.ph" || val1 === "@gmail.com";
    const valid2 = val2.length > 0;

    // Determine current permutation
    if(!valid1 && !valid2) perm = "t1t2unsat";
    else if(!valid1 && valid2) perm = "t1unsat_t2sat";
    else if(valid1 && !valid2) perm = "t1sat_t2unsat";
    else perm = "t1t2sat";

    // Reset counter if permutation changed
    if(perm !== lastPermutation) clickCounter = 0;
    lastPermutation = perm;
    clickCounter++;

    // Determine message based on rules
    if(clickCounter >= 10) message.textContent = "Leave.";
    else if(perm === "t1t2unsat") {
      if(clickCounter === 3) message.textContent = "Do you even exist?";
      else if(clickCounter === 5) message.textContent = "Then there's nothing for you here.";
      else message.textContent = "Unknown.";
    } else if(perm === "t1unsat_t2sat") {
      if(clickCounter === 5) message.textContent = "Your E-mail.";
      else if(clickCounter === 3) message.textContent = "But where to go?";
      else message.textContent = "Unknown Answer.";
    } else if(perm === "t1sat_t2unsat") {
      if(clickCounter === 5) message.textContent = "Answer the question.";
      else if(clickCounter === 3) message.textContent = "Nothing to say?";
      else message.textContent = "Unknown Destination.";
    } else if(perm === "t1t2sat") {
      message.textContent = "Thank you.";
      box1.value = "";
      box2.value = "";
    }
  });

</script>

</body>
</html>
