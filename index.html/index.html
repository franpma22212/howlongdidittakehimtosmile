<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Form</title>

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }

    body {
      background-color: black;
      color: #aaa;
      font-family: monospace;
      display: flex;
      justify-content: center; 
      align-items: center;     
      flex-direction: column;
    }

    p, input, button, #message {
      font-family: monospace;
      font-size: 24px;
    }

    .outer-box {
      background-color: #020a1e;
      padding: 10px;
      display: inline-block;
      margin: 15px auto;
      border-radius: 0px !important;
      width: 300px;
      height: 80px;
      box-sizing: border-box;
    }

    .outer-box input {
      background-color: #1c2a45;
      color: #aaa;
      border: 2px solid #1c2a45;
      border-radius: 0px !important;
      padding: 0 10px;
      font-size: 24px;
      outline: none;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
    }

    button {
      background-color: #555;
      border: 3px solid #888;
      border-radius: 12px;
      padding: 0 50px;
      cursor: pointer;
      margin-top: 20px;
      font-size: 0;
      height: 50px;
    }

    #message {
      color: #aaa;
      margin-top: 15px;
      min-height: 24px;
      font-size: 24px;
    }
  </style>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";

    // Your Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA6CxVBm-kw7FcYho3-ajLe0JpSlOaWI98",
      authDomain: "how-long-did-it-take-to-smile.firebaseapp.com",
      projectId: "how-long-did-it-take-to-smile",
      storageBucket: "how-long-did-it-take-to-smile.firebasestorage.app",
      messagingSenderId: "206169272440",
      appId: "1:206169272440:web:03208a7c05b26ee8147d8d",
      measurementId: "G-VE0LZRLPM4"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // Make db available globally
    window.db = db;
  </script>

</head>
<body>

<p>How long did it take him to smile?</p>

<div class="outer-box">
  <input type="text" id="box1" />
</div>

<div class="outer-box">
  <input type="text" id="box2" />
</div>

<button onclick="submitForm()"></button>

<div id="message"></div>

<script>
  let input1 = "";
  let input2 = "";
  let permutationClicks = 0; // clicks for current permutation
  let totalClicks = 0;       // total clicks for this permutation
  let lastPermutation = "";

  const validEmails = ["@depedmarikina.ph", "@gmail.com"];

  // Save input on blur and send to Firebase
  document.getElementById("box1").addEventListener("blur", async function() {
    input1 = this.value;
    try {
      await addDoc(collection(window.db, "inputs"), {
        box: "box1",
        value: input1,
        timestamp: Date.now()
      });
      console.log("Box1 input saved!");
    } catch (e) {
      console.error("Error saving Box1:", e);
    }
  });

  document.getElementById("box2").addEventListener("blur", async function() {
    input2 = this.value;
    try {
      await addDoc(collection(window.db, "inputs"), {
        box: "box2",
        value: input2,
        timestamp: Date.now()
      });
      console.log("Box2 input saved!");
    } catch (e) {
      console.error("Error saving Box2:", e);
    }
  });

  function isTextbox1Valid(value) {
    value = value.toLowerCase();
    return validEmails.some(email => value.includes(email));
  }

  function submitForm() {
    let valid1 = isTextbox1Valid(input1);
    let valid2 = input2.trim().length > 0;

    let permutation = `${valid1}-${valid2}`;

    if (permutation !== lastPermutation) {
      permutationClicks = 0;
      totalClicks = 0;
      lastPermutation = permutation;
    }

    permutationClicks++;
    totalClicks++;

    // 10-click message
    if (totalClicks >= 10) {
      document.getElementById("message").textContent = "Leave.";
      return;
    }

    // 5-click messages
    if (permutationClicks >= 5) {
      if (!valid1 && !valid2) {
        document.getElementById("message").textContent = "Then there's nothing for you here.";
        return;
      }
      if (!valid1 && valid2) {
        document.getElementById("message").textContent = "Your E-mail.";
        return;
      }
      if (valid1 && !valid2) {
        document.getElementById("message").textContent = "Answer the question.";
        return;
      }
    }

    // 3-click messages
    if (permutationClicks >= 3) {
      if (!valid1 && !valid2) {
        document.getElementById("message").textContent = "Do you even exist?";
        return;
      }
      if (!valid1 && valid2) {
        document.getElementById("message").textContent = "But where to go?";
        return;
      }
      if (valid1 && !valid2) {
        document.getElementById("message").textContent = "Nothing to say?";
        return;
      }
    }

    // Regular messages
    if (!valid1 && !valid2) {
      document.getElementById("message").textContent = "Unknown.";
      return;
    }

    if (!valid1 && valid2) {
      document.getElementById("message").textContent = "Unknown Destination.";
      return;
    }

    if (valid1 && !valid2) {
      document.getElementById("message").textContent = "Unknown Answer.";
      return;
    }

    if (valid1 && valid2) {
      document.body.innerHTML = "<p style='color:#aaa; font-family: monospace; font-size: 32px;'>Thank you.</p>";
    }
  }
</script>

</body>
</html>
